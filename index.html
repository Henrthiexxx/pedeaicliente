<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pedra Delivery- Painel da Loja</title>
    <meta name="theme-color" content="#6366f1">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="toast" id="toast"></div>
    
    <!-- Notification Popup -->
    <div class="notification-popup" id="notificationPopup">
        <div class="notification-popup-content">
            <div class="notification-popup-icon">ğŸ””</div>
            <div class="notification-popup-text">
                <div class="notification-popup-title">Novo Pedido!</div>
                <div class="notification-popup-body" id="notificationPopupBody">VocÃª tem um novo pedido</div>
            </div>
            <button class="notification-popup-close" onclick="closeNotificationPopup()">Ã—</button>
        </div>
    </div>
    
    <!-- Auth -->
    <div id="authPage" class="auth-container">
        <div class="auth-box">
            <div class="auth-logo">
                <h1>Pedra Delivery</h1>
                <p style="color: var(--text-muted); margin-top: 8px;">Painel do estabelecimento</p>
            </div>
            <div class="card">
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">E-mail</label>
                        <input type="email" class="form-input" id="loginEmail" placeholder="loja@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Entrar</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
        
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">Pedra Delivery</div>
                <div class="store-info">
                    <div class="store-avatar" id="sidebarAvatar">ğŸ”</div>
                    <div>
                        <div class="store-name" id="sidebarStoreName">Minha Loja</div>
                        <div class="store-status" id="sidebarStatus">ğŸŸ¢ Aberto</div>
                    </div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item active" onclick="showPage('dashboard')"><span>ğŸ“Š</span> Painel Central</div>
                    <div class="nav-item" onclick="showPage('orders')"><span>ğŸ“¦</span> Pedidos <span class="nav-badge" id="pendingBadge" style="display:none;">0</span></div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">CardÃ¡pio</div>
                    <div class="nav-item" onclick="openProductsPage()"><span>ğŸ½ï¸</span> Produtos</div>


                   <div class="nav-item" onclick="openPopup('categories.html')"><span>ğŸ“</span> Categorias</div>

                <div class="nav-section">
                    <div class="nav-section-title">ConfiguraÃ§Ãµes</div>
                 
</div>

                    <div class="nav-item" onclick="openConfigPopup()"><span>âš™ï¸</span> ConfiguraÃ§Ãµes</div>

                    <div class="nav-item" onclick="handleLogout()"><span>ğŸšª</span> Sair</div>
                </div>
            </nav>
        </aside>
        
        <!-- Main -->
        <main class="main-content">
            <header class="topbar">
                <div style="display: flex; align-items: center; gap: 16px;">
                    <button class="menu-toggle" onclick="toggleSidebar()">â˜°</button>
                    <h1 class="topbar-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="topbar-actions">
                    <button class="btn btn-sm" id="notifBtn" onclick="requestNotificationPermission()" title="Ativar notificaÃ§Ãµes">ğŸ””</button>
                    <div class="toggle" id="storeToggle" onclick="toggleStoreStatus()"></div>
                </div>
            </header>
            
            <!-- Dashboard -->
            <div id="dashboardPage" class="page active">
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-icon warning">ğŸ“¦</div><div class="stat-value" id="statPending">0</div><div class="stat-label">Pedidos pendentes</div></div>
                    <div class="stat-card"><div class="stat-icon primary">ğŸ“‹</div><div class="stat-value" id="statToday">0</div><div class="stat-label">Pedidos hoje</div></div>
                    <div class="stat-card"><div class="stat-icon success">ğŸ’°</div><div class="stat-value" id="statRevenue">R$ 0</div><div class="stat-label">Faturamento hoje</div></div>
                    <div class="stat-card"><div class="stat-icon danger">ğŸ½ï¸</div><div class="stat-value" id="statProducts">0</div><div class="stat-label">Produtos ativos</div></div>
                </div>
                <div class="card">
                    <div class="card-header"><div class="card-title">ğŸ“¦ Pedidos Recentes</div><button class="btn btn-secondary btn-sm" onclick="showPage('orders')">Ver todos</button></div>
                    <div id="recentOrders"></div>
                </div>
            </div>
            
            <!-- Orders -->
            <div id="ordersPage" class="page">
                <div class="orders-filters">
                    <div class="filter-chip active" onclick="filterOrders('all')">Todos</div>
                    <div class="filter-chip" onclick="filterOrders('pending')">ğŸŸ¡ Pendentes</div>
                    <div class="filter-chip" onclick="filterOrders('preparing')">ğŸ”µ Preparando</div>
                    <div class="filter-chip" onclick="filterOrders('ready')">ğŸŸ£ Pronto</div>
                    <div class="filter-chip" onclick="filterOrders('delivering')">ğŸŸ¢ Entregando</div>
                    <div class="filter-chip" onclick="filterOrders('delivered')">âœ… Entregues</div>
                </div>
                <div id="ordersList"></div>
            </div>
            
            <!-- Products -->
            <div id="productsPage" class="page">
                <div class="products-header">
                    <input type="text" class="form-input" style="max-width: 300px;" placeholder="ğŸ” Buscar produto..." id="productSearch" oninput="filterProductsList()">
                    <button class="btn btn-primary" onclick="openProductModal()">+ Novo Produto</button>
                </div>
                <div class="products-grid" id="productsList"></div>
            </div>
            
            <!-- Categories -->
            <div id="categoriesPage" class="page">
                <div class="products-header">
                    <h3>Categorias do CardÃ¡pio</h3>
                    <button class="btn btn-primary" onclick="openCategoryModal()">+ Nova Categoria</button>
                </div>
                <div id="categoriesList"></div>
            </div>
            
            <!-- Store -->
            <div id="storePage" class="page">
                <div class="card">
                    <div class="card-title" style="margin-bottom: 20px;">InformaÃ§Ãµes da Loja</div>
                    <div class="form-group">
                        <label class="form-label">Logo / Imagem da Loja</label>
                        <div class="image-upload" id="storeImageUpload" onclick="document.getElementById('storeImageInput').click()">
                            <div class="image-upload-placeholder" id="storeImagePlaceholder"><span>ğŸ“·</span><div>Clique para enviar imagem</div></div>
                            <input type="file" id="storeImageInput" accept="image/*" onchange="handleStoreImageUpload(event)">
                        </div>
                    </div>
                    <div class="form-group"><label class="form-label">Nome da Loja</label><input type="text" class="form-input" id="storeName" placeholder="Nome do estabelecimento"></div>
                    <div class="form-group">
                        <label class="form-label">Categoria</label>
                        <select class="form-input" id="storeCategory">
                            <option value="HambÃºrgueres">ğŸ” HambÃºrgueres</option>
                            <option value="Pizzaria">ğŸ• Pizzaria</option>
                            <option value="Japonesa">ğŸ£ Japonesa</option>
                            <option value="AÃ§aÃ­ e Sorvetes">ğŸ‡ AÃ§aÃ­ e Sorvetes</option>
                            <option value="Brasileira">ğŸ› Brasileira</option>
                            <option value="Lanches">ğŸŒ­ Lanches</option>
                            <option value="Doces">ğŸ° Doces</option>
                            <option value="Bebidas">ğŸ¹ Bebidas</option>
                            <option value="Outro">ğŸ“¦ Outro</option>
                        </select>
                    </div>
                    <div class="form-group"><label class="form-label">DescriÃ§Ã£o</label><textarea class="form-input" id="storeDescription" placeholder="Fale sobre sua loja..."></textarea></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group"><label class="form-label">Tempo de entrega</label><input type="text" class="form-input" id="storeDeliveryTime" placeholder="30-45 min"></div>
                        <div class="form-group"><label class="form-label">Taxa de entrega (R$)</label><input type="number" class="form-input" id="storeDeliveryFee" placeholder="5.00" step="0.50"></div>
                    </div>
                    <div class="form-group"><label class="form-label">EndereÃ§o</label><input type="text" class="form-input" id="storeAddress" placeholder="Rua, nÃºmero - Bairro"></div>
                    <div class="form-group"><label class="form-label">Telefone / WhatsApp</label><input type="tel" class="form-input" id="storePhone" placeholder="(00) 00000-0000"></div>
                    <button class="btn btn-primary btn-block" onclick="saveStoreInfo()">Salvar InformaÃ§Ãµes</button>
                </div>
            </div>
            
            <!-- Settings -->
            <div id="settingsPage" class="page">
                <div class="settings-section">
                    <div class="settings-title">ğŸšš Entrega</div>
                    <div class="form-group">
                        <label class="form-label">Tipo de entregador</label>
                        <div class="radio-cards">
                            <div class="radio-card" id="deliveryApp" onclick="selectDeliveryType('app')"><div class="radio-card-icon">ğŸ›µ</div><div class="radio-card-title">Entregador do App</div><div class="radio-card-desc">Entregadores parceiros</div></div>
                            <div class="radio-card" id="deliveryOwn" onclick="selectDeliveryType('own')"><div class="radio-card-icon">ğŸ‘¨â€ğŸ’¼</div><div class="radio-card-title">Entregador PrÃ³prio</div><div class="radio-card-desc">Sua equipe</div></div>
                            <div class="radio-card" id="deliveryBoth" onclick="selectDeliveryType('both')"><div class="radio-card-icon">ğŸ”„</div><div class="radio-card-title">Ambos</div><div class="radio-card-desc">Conforme disponibilidade</div></div>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">ğŸ• HorÃ¡rio de Funcionamento</div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">Segunda a Sexta</div>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <input type="time" class="form-input" id="weekdayOpen" value="18:00" style="width: auto;">
                                <span style="align-self: center;">Ã s</span>
                                <input type="time" class="form-input" id="weekdayClose" value="23:00" style="width: auto;">
                            </div>
                        </div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info">
                            <div class="setting-label">SÃ¡bado e Domingo</div>
                            <div style="display: flex; gap: 8px; margin-top: 8px;">
                                <input type="time" class="form-input" id="weekendOpen" value="11:00" style="width: auto;">
                                <span style="align-self: center;">Ã s</span>
                                <input type="time" class="form-input" id="weekendClose" value="23:00" style="width: auto;">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-section">
                    <div class="settings-title">ğŸ”” NotificaÃ§Ãµes</div>
                    <div class="setting-item">
                        <div class="setting-info"><div class="setting-label">Som de novo pedido</div><div class="setting-desc">Tocar som quando receber pedido</div></div>
                        <div class="toggle active" id="soundToggle" onclick="toggleSetting('sound')"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><div class="setting-label">Aceitar automaticamente</div><div class="setting-desc">Confirmar pedidos sem aprovaÃ§Ã£o</div></div>
                        <div class="toggle" id="autoAcceptToggle" onclick="toggleSetting('autoAccept')"></div>
                    </div>
                    <div class="setting-item">
                        <div class="setting-info"><div class="setting-label">NotificaÃ§Ãµes Push</div><div class="setting-desc">Receber alertas com app fechado</div></div>
                        <button class="btn btn-primary btn-sm" onclick="requestNotificationPermission()">Ativar</button>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="saveSettings()">Salvar ConfiguraÃ§Ãµes</button>
            </div>
        </main>
    </div>
    

    
    <!-- Category Modal -->
    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header"><div class="modal-title">Nova Categoria</div><button class="modal-close" onclick="closeModal('categoryModal')">Ã—</button></div>
            <div class="modal-body">
                <div class="form-group"><label class="form-label">Nome da Categoria</label><input type="text" class="form-input" id="categoryName" placeholder="Ex: Lanches, Bebidas..."></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('categoryModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="saveCategory()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <div class="modal-title" id="confirmModalTitle" style="margin-bottom: 12px;">Confirmar</div>
                <div style="color: var(--text-muted); margin-bottom: 24px;" id="confirmModalText">Deseja continuar?</div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-secondary" id="confirmModalCancel" onclick="closeModal('confirmModal')" style="flex:1;">Cancelar</button>
                    <button class="btn btn-danger" id="confirmModalBtn" style="flex:1;">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-messaging-compat.js"></script>
    
    <!-- App -->
    <script src="modules/fcm.js"></script>
    <script src="index.js"></script>
    <div id="modalProducts" style="display:none; position:fixed; inset:0; z-index:99999;">
  <div onclick="closeProductsModal()" ontouchstart="closeProductsModal(); return false;"
       style="position:absolute; inset:0; background:rgba(0,0,0,.65)"></div>

  <div style="
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:min(1100px, 96vw); height:min(860px, 92dvh);
    background:#0a0a0a; border:1px solid #262626; border-radius:14px;
    overflow:hidden; box-shadow:0 25px 80px rgba(0,0,0,.6);
    display:flex; flex-direction:column;">
    
    <div style="height:52px; display:flex; align-items:center; justify-content:space-between;
      padding:0 14px; border-bottom:1px solid #262626; background:#000;">
      <div style="font-weight:800">ğŸ½ï¸ Produtos</div>
      <button class="btn" type="button" onclick="closeProductsModal()"
        ontouchstart="closeProductsModal(); return false;">âœ• Fechar</button>
    </div>

    <iframe id="productsFrame" src="about:blank"
      style="flex:1; width:100%; border:0; background:#000;"></iframe>
  </div>
</div>
<div id="configModal" class="modal">
  <div class="modalBox">
    <button class="modalClose" onclick="closeConfigPopup()">âœ•</button>
    <iframe id="configFrame" src="config.html"></iframe>
  </div>
</div>

<script src="modules/popup-system.js"></script>
<script src="modules/fixes.js"></script>
<script src="modules/billing-system.js"></script>
<script src="modules/fixes.js"></script>
<script>
function openConfigPopup(){
  document.getElementById('configModal').classList.add('show');
}
function closeConfigPopup(){
  document.getElementById('configModal').classList.remove('show');
}
window.addEventListener('message',(e)=>{
  if(e.data==='closeConfig') closeConfigPopup();
});
</script>
<div id="appPopup" class="modal">
  <div class="modalBox">
    <button class="modalClose" onclick="closePopup()">âœ•</button>
    <iframe id="popupFrame"></iframe>
  </div>
</div>
<script>
function openPopup(page){
  const modal = document.getElementById('appPopup');
  const frame = document.getElementById('popupFrame');
  frame.src = page;
  modal.classList.add('show');
}
function closePopup(){
  document.getElementById('appPopup').classList.remove('show');
  document.getElementById('popupFrame').src = '';
}

/* permite fechar de dentro do iframe */
window.addEventListener('message', (e)=>{
  if(e.data === 'closePopup') closePopup();
});
</script>


</body>
</html>
