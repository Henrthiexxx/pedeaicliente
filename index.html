<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Pedrad - Delivery</title>
    <meta name="theme-color" content="#6366f1">
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="offline-banner" id="offlineBanner">ğŸ“´ VocÃª estÃ¡ offline</div>
    <div class="toast" id="toast"></div>
    
    <!-- Auth Page -->
    <div id="authPage" class="auth-container">
        <div class="auth-logo">
            <h1>ğŸ›µ Pedrad</h1>
            <p>Seu delivery favorito</p>
        </div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">Entrar</button>
            <button class="auth-tab" onclick="switchAuthTab('register')">Criar conta</button>
        </div>
        
        <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
            <div class="input-group">
                <label>E-mail</label>
                <input type="email" class="input" id="loginEmail" placeholder="seu@email.com" required>
            </div>
            <div class="input-group">
                <label>Senha</label>
                <input type="password" class="input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
            </div>
            <button type="submit" class="btn btn-primary">Entrar</button>
        </form>
        
        <form id="registerForm" class="auth-form" onsubmit="handleRegister(event)">
            <div class="input-group">
                <label>Nome completo</label>
                <input type="text" class="input" id="registerName" placeholder="Seu nome" required>
            </div>
            <div class="input-group">
                <label>E-mail</label>
                <input type="email" class="input" id="registerEmail" placeholder="seu@email.com" required>
            </div>
            <div class="input-group">
                <label>Telefone</label>
                <input type="tel" class="input" id="registerPhone" placeholder="(00) 00000-0000" required>
            </div>
            <div class="input-group">
                <label>Senha</label>
                <input type="password" class="input" id="registerPassword" placeholder="MÃ­nimo 6 caracteres" required minlength="6">
            </div>
            <button type="submit" class="btn btn-primary">Criar conta</button>
        </form>
    </div>
    
    <!-- Main App -->
    <div id="mainApp" style="display: none;">
        <header class="header">
            <div class="header-title">ğŸ›µ Pedrad</div>
            <div class="header-actions">
                <button class="header-btn" onclick="showPage('cart')">
                    ğŸ›’
                    <span class="cart-badge" id="cartBadge"></span>
                </button>
            </div>
        </header>
        
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <!-- Review Prompt Container -->
            <div id="reviewPromptContainer"></div>
            
            <div id="storeSelection">
                <h2 style="margin-bottom: 8px;">ğŸª Escolha uma loja</h2>
                <p style="color: var(--text-muted); margin-bottom: 20px;">Selecione onde vocÃª quer pedir</p>
                
                <!-- Filtros -->
                <div id="storeFilters"></div>
                
                <div id="storesGrid" class="stores-grid"></div>
            </div>
            
            <div id="storeMenu" style="display: none;">
                <div class="store-header-bar" onclick="backToStores()">
                    <span class="back-btn">â†</span>
                    <div class="store-header-info">
                        <span class="store-header-name" id="selectedStoreName">Loja</span>
                        <span class="store-header-status" id="selectedStoreStatus">Aberto</span>
                    </div>
                </div>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="ğŸ” Buscar produtos..." id="searchInput" oninput="filterProducts()">
                </div>
                
                <div class="categories" id="categoriesContainer"></div>
                <div class="products-grid" id="productsGrid"></div>
            </div>
        </div>
        
        <!-- Cart Page -->
        <div id="cartPage" class="page">
            <h2 style="margin-bottom: 20px;">ğŸ›’ Carrinho</h2>
            <div id="cartItems"></div>
            <div id="cartSummary" style="display: none;">
                <div class="card" style="margin-top: 16px;">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="cartSubtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row" id="cartDiscountRow" style="display:none; color: var(--success);">
                        <span>Desconto</span>
                        <span id="cartDiscount">- R$ 0,00</span>
                    </div>
                    <div class="summary-row">
                        <span>Taxa de entrega</span>
                        <span id="cartDelivery">R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="cartTotal">R$ 0,00</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="showCheckout()" style="margin-top: 16px;">
                    Finalizar pedido
                </button>
            </div>
        </div>
        
        <!-- Orders Page -->
        <div id="ordersPage" class="page">
            <h2 style="margin-bottom: 20px;">ğŸ“¦ Meus Pedidos</h2>
            <div id="ordersList"></div>
        </div>
        
        <!-- Profile Page -->
        <div id="profilePage" class="page">
            <div class="profile-header">
                <div id="profileAvatarContainer"></div>
                <div class="profile-name" id="profileName">-</div>
                <div class="profile-email" id="profileEmail">-</div>
            </div>
            
            <div class="profile-menu">
                <div class="profile-menu-item" onclick="showPage('addresses')">
                    <div class="profile-menu-icon">ğŸ“</div>
                    <div class="profile-menu-text">Meus endereÃ§os</div>
                    <div class="profile-menu-arrow">â€º</div>
                </div>
                <div class="profile-menu-item" onclick="showPage('orders')">
                    <div class="profile-menu-icon">ğŸ“¦</div>
                    <div class="profile-menu-text">HistÃ³rico de pedidos</div>
                    <div class="profile-menu-arrow">â€º</div>
                </div>
                <div class="profile-menu-item" onclick="handleLogout()">
                    <div class="profile-menu-icon">ğŸšª</div>
                    <div class="profile-menu-text" style="color: var(--danger);">Sair</div>
                    <div class="profile-menu-arrow">â€º</div>
                </div>
            </div>
        </div>
        
        <!-- Addresses Page -->
        <div id="addressesPage" class="page">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <span style="font-size: 1.5rem; cursor: pointer;" onclick="showPage('profile')">â†</span>
                <h2>ğŸ“ Meus EndereÃ§os</h2>
            </div>
            <div id="addressesList"></div>
            <button class="btn btn-primary" onclick="showAddAddressModal()" style="margin-top: 16px;">
                + Adicionar endereÃ§o
            </button>
        </div>
        
        <!-- Tracking Page -->
        <div id="trackingPage" class="page"></div>
        
        <!-- Navigation -->
        <nav class="nav">
            <div class="nav-item active" onclick="showPage('home')">
                <span>ğŸ </span>
                InÃ­cio
            </div>
            <div class="nav-item" onclick="showPage('orders')">
                <span>ğŸ“¦</span>
                Pedidos
            </div>
            <div class="nav-item" onclick="showPage('profile')">
                <span>ğŸ‘¤</span>
                Perfil
            </div>
        </nav>
    </div>
    
    <!-- Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="product-detail-img" id="modalProductImg">ğŸ”</div>
            <div class="product-detail-info">
                <div class="product-detail-name" id="modalProductName">-</div>
                <div class="product-detail-desc" id="modalProductDesc">-</div>
                <div class="product-detail-price" id="modalProductPrice">R$ 0,00</div>
                
                <div class="product-qty-selector">
                    <button class="product-qty-btn" onclick="changeModalQty(-1)">âˆ’</button>
                    <span class="product-qty-value" id="modalQty">1</span>
                    <button class="product-qty-btn" onclick="changeModalQty(1)">+</button>
                </div>
                
                <button class="btn btn-primary" onclick="addToCartFromModal()">Adicionar ao carrinho</button>
                <button class="btn btn-secondary" onclick="closeModal('productModal')" style="margin-top: 8px;">Cancelar</button>
            </div>
        </div>
    </div>
    
    <!-- Checkout Modal -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Finalizar Pedido</div>
                <button class="modal-close" onclick="closeModal('checkoutModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <h3 style="margin-bottom: 12px;">ğŸ“ EndereÃ§o de entrega</h3>
                <div id="checkoutAddresses"></div>
                
                <button class="btn btn-secondary btn-sm" onclick="showAddAddressModal()" style="margin-bottom: 24px;">
                    + Adicionar novo endereÃ§o
                </button>
                
                <h3 style="margin-bottom: 12px;">ğŸŸï¸ Cupom de desconto</h3>
                <div class="coupon-box">
                    <input type="text" class="input" id="couponInput" placeholder="Digite o cÃ³digo">
                    <button class="btn btn-secondary btn-sm" onclick="applyCoupon()">Aplicar</button>
                </div>
                <div id="couponStatus" class="coupon-status"></div>
                
                <h3 style="margin-bottom: 12px;">ğŸ’³ Forma de pagamento</h3>
                <div class="address-card selected" style="margin-bottom: 24px;">
                    <div class="address-icon">ğŸ’µ</div>
                    <div class="address-info">
                        <div class="address-label">Dinheiro</div>
                        <div class="address-text">Pagar na entrega</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span id="checkoutSubtotal">R$ 0,00</span>
                    </div>
                    <div class="summary-row" id="checkoutDiscountRow" style="display:none; color: var(--success);">
                        <span>Desconto</span>
                        <span id="checkoutDiscount">- R$ 0,00</span>
                    </div>
                    <div class="summary-row">
                        <span>Entrega (<span id="checkoutNeighborhood">-</span>)</span>
                        <span id="checkoutDelivery">R$ 0,00</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span id="checkoutTotal">R$ 0,00</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="submitOrder()" style="margin-top: 16px;">
                    Confirmar pedido
                </button>
            </div>
        </div>
    </div>
    
    <!-- Add Address Modal -->
    <div class="modal" id="addressModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Novo EndereÃ§o</div>
                <button class="modal-close" onclick="closeModal('addressModal')">Ã—</button>
            </div>
            <div class="modal-body">
                <form onsubmit="saveAddress(event)">
                    <div class="input-group">
                        <label>Apelido (ex: Casa, Trabalho)</label>
                        <input type="text" class="input" id="addressLabel" placeholder="Casa" required>
                    </div>
                    <div class="input-group">
                        <label>Rua</label>
                        <input type="text" class="input" id="addressStreet" placeholder="Nome da rua" required>
                    </div>
                    <div class="input-group">
                        <label>NÃºmero</label>
                        <input type="text" class="input" id="addressNumber" placeholder="123" required>
                    </div>
                    <div class="input-group">
                        <label>Complemento</label>
                        <input type="text" class="input" id="addressComplement" placeholder="Apto, Bloco...">
                    </div>
                    <div class="input-group">
                        <label>Bairro</label>
                        <select class="input" id="addressNeighborhood" required>
                            <option value="">Selecione o bairro</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Ponto de referÃªncia</label>
                        <input type="text" class="input" id="addressReference" placeholder="PrÃ³ximo a...">
                    </div>
                    
                    <div class="location-box" id="addressLocationBox">
                        <div class="location-status" id="addressLocationStatus">
                            <span class="location-icon">ğŸ“</span>
                            <span>LocalizaÃ§Ã£o nÃ£o capturada</span>
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="captureAddressLocation()">
                            ğŸ“ Usar minha localizaÃ§Ã£o
                        </button>
                    </div>
<div style="display:flex;gap:8px;">
    <button type="button" class="btn btn-secondary" onclick="captureAddressLocation()" style="flex:1;">ğŸ“ GPS automÃ¡tico</button>
    <button type="button" class="btn btn-secondary" onclick="openMapPicker()" style="flex:1;">ğŸ—ºï¸ Escolher no mapa</button>
</div>
</div>
                    <button type="submit" class="btn btn-primary">Salvar endereÃ§o</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Order Detail Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Detalhes do Pedido</div>
                <button class="modal-close" onclick="closeModal('orderModal')">Ã—</button>
            </div>
            <div class="modal-body" id="orderDetailContent"></div>
        </div>
    </div>
    
    <!-- Review Modal -->
    <div class="modal" id="reviewModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">â­ Avaliar Pedido</div>
                <button class="modal-close" onclick="closeModal('reviewModal')">Ã—</button>
            </div>
            <div class="modal-body" id="reviewModalContent"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="modules/stores.js"></script>
    <script src="modules/profile.js"></script>
    <script src="modules/notifications.js"></script>
    <script src="modules/tracking.js"></script>
    <script src="index.js"></script>
</body>
</html>